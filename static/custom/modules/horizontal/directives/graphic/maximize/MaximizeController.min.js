define(function(require){"use strict";var pv=require("cdf/lib/CCC/protovis");return{generateController:function(module,ctrlName){return angular.module(module).controller(ctrlName,function($scope,$modalInstance,$log,$state,$stateParams,parameters,dvtUtils,configService,$rootScope){var resolution=window.resolution;$(window).on("resize",function(e){resolution=window.resolution});var country1=$rootScope.defaultCountryDefaultValue,country2="0";null!=$stateParams.pCountry1?country1=$stateParams.pCountry1:void 0!=$rootScope.defaultCountry&&void 0!=$rootScope.defaultCountry.code&&(country1=$rootScope.defaultCountry.code),null!=$stateParams.pCountry2?country2=$stateParams.pCountry2:void 0!=$rootScope.defaultCountry2&&(country2=$rootScope.defaultCountry2.code),$scope.dashboard={parameters:{pSplit:$rootScope.pSplit,pSplit2:$rootScope.pSplit2,pDataset:$rootScope.pDataset,pCountry1:country1,pCountry2:country2}},$scope.parameters=parameters,$stateParams.pGroup&&void 0!=$stateParams.pGroup&&($scope.dashboard.parameters.approach=$stateParams.pGroup.replace("group",""),dvtUtils.fixGroupColor($stateParams.pGroup.replace("pGroup",""),$scope)),$scope.parameters.parameters.push(["pMaximized","1"]),parameters.angle&&($scope.parameters.chartDefinition.baseAxisLabel_textAngle=1==parameters.angle?-Math.PI/3:-Math.PI/6.5,"horizontal"==$scope.parameters.chartDefinition.orientation||0==parameters.angle?($scope.parameters.chartDefinition.baseAxisLabel_textAngle=0,$scope.parameters.chartDefinition.baseAxisLabel_textAlign="right",$scope.parameters.chartDefinition.baseAxisLabel_textBaseline="middle"):($scope.parameters.chartDefinition.baseAxisLabel_textAlign="right",$scope.parameters.chartDefinition.baseAxisLabel_textBaseline="top")),$scope.parameters.customLabel&&($scope.parameters.chartDefinition.baseAxisLabelLongText=function(scene){var country=scene.firstAtoms.category.label,pCountry1=$scope.parameters.parameters[1]?$scope.parameters.parameters[1][1]:null,pCountry2=$scope.parameters.parameters[2]?$scope.parameters.parameters[2][1]:null;return country.match(pCountry1)?pCountry1:country.match(pCountry2)?pCountry2:void 0}),$scope.parameters.chartDefinition&&("vertical"==$scope.parameters.chartDefinition.orientation?$scope.parameters.chartDefinition.baseAxisLabel_textAlign=$scope.parameters.baseAxisLabelTextAlign||"center":"horizontal"==$scope.parameters.chartDefinition.orientation&&($scope.parameters.chartDefinition.baseAxisLabel_textAlign=$scope.parameters.baseAxisLabelTextAlign||"right"),$state.current.url.match("osh-outcomes-working-conditions")&&($scope.parameters.baseAxisSize=resolution<=768?100:190,"Health at risk"==$scope.parameters.chartTitle&&($scope.parameters.baseAxisSize=90),"Risk Assessment"!=$scope.parameters.chartTitle&&"Employees participation in prevention"!=$scope.parameters.chartTitle||($scope.parameters.baseAxisSize=90)),$scope.parameters.chartDefinition.baseAxisLabel_font='14px "OpenSans-bold"',$scope.parameters.chartDefinition.baseAxisLabel_textAlign="center",$scope.parameters.chartDefinition.axisLabel_font='14px "OpenSans-bold"',$scope.parameters.chartDefinition.legend_font='normal 14px "OpenSans"',$scope.parameters.chartDefinition.clickable=!1,$scope.parameters.chartDefinition.hoverable=!1,"horizontal"==$scope.parameters.chartDefinition.orientation?parameters.chartDefinition.baseAxisLabel_textAlign="right":parameters.chartDefinition.baseAxisLabel_textAlign="center",$scope.parameters.chartDefinition.legend=!$scope.parameters.pyramid,"economic-sector-profile"==$state.current.name&&("getGDPData"==$scope.parameters.chartDefinition.dataAccessId&&($scope.parameters.legendClickMode="none",$scope.parameters.chartDefinition.plots[0].bar_call=function(){this.add(pv.Image).url(function(scene){var countryKey=scene.firstAtoms.category;return countryKey.label.match($stateParams.pCountry1)||countryKey.label.match($scope.dashboard.parameters.pCountry1)?configService.getImagesPath()+"man_orange.svg":countryKey.label.match($stateParams.pCountry2)||countryKey.label.match($scope.dashboard.parameters.pCountry2)?configService.getImagesPath()+"man.svg":"EU28"==countryKey?configService.getImagesPath()+"man_blue.svg":void 0}).bottom(20).height(function(scene){this.root.sign.chart.options.legendDot_fillStyle=function(scene){var countryKey=scene.firstAtoms.category;return countryKey.label.match($stateParams.pCountry1)||countryKey.label.match($scope.dashboard.parameters.pCountry1)?dvtUtils.getColorCountry(1):countryKey.label.match($stateParams.pCountry2)||countryKey.label.match($scope.dashboard.parameters.pCountry2)?dvtUtils.getColorCountry(2):"EU28"==countryKey?dvtUtils.getEUColor():void 0};var axisFixedMax=this.root.sign.chart.options.axisFixedMax,panelHeight=this.root.height(),valueKey=scene.firstAtoms.value,resul=valueKey*(panelHeight-this.bottom())/axisFixedMax;return valueKey>=220&&(this.root.sign.chart.options.axisFixedMax=420),resul}).width(function(scene){scene.firstAtoms.value;return.45333*this.height()}).left(function(scene){var panelWidth=this.root.width(),barWidth=panelWidth/4,countryKey=scene.firstAtoms.category;if(300!=panelWidth){if(countryKey.label.match($stateParams.pCountry1)||countryKey.label.match($scope.dashboard.parameters.pCountry1))return scene.nextSibling.firstAtoms.category.label.match($stateParams.pCountry2)?panelWidth/2-this.width()/2-panelWidth/3:panelWidth/2-this.width()/2-barWidth-5;if(countryKey.label.match($stateParams.pCountry2)||countryKey.label.match($scope.dashboard.parameters.pCountry2)){return null==scene.previousSibling?panelWidth/2-(barWidth+this.width()/2)-5:panelWidth/2-this.width()/2-10}if("EU28"==countryKey){var firstSibling=scene.previousSibling.previousSibling;return scene.previousSibling.firstAtoms.category.label.match($stateParams.pCountry2)&&null!=firstSibling?panelWidth-this.width()/2-panelWidth/5.45:panelWidth-(barWidth+this.width()/2)-10}}}).events("all").cursor("hand")}),"getCompanySizeData"==$scope.parameters.chartDefinition.dataAccessId&&($scope.parameters.chartDefinition.legendItemSize=300,$scope.parameters.chartDefinition.legendSize=150,resolution<=325&&($scope.parameters.chartDefinition.legendItemSize=300),resolution<=380&&resolution>325&&($log.warn("resolution < 425"),$scope.parameters.chartDefinition.legendItemSize=320)),"getEmploymentPerSectorData"==$scope.parameters.chartDefinition.dataAccessId&&($scope.parameters.chartDefinition.legendItemSize=340,resolution<=425&&resolution>325&&($scope.parameters.chartDefinition.legendItemSize=280),resolution<=325&&($scope.parameters.chartDefinition.legendItemSize=280))),$log.debug("Chart type: "+$scope.parameters.chartType),$log.debug("Is staked:.................................."+$scope.parameters.chartDefinition.stacked),$scope.stacked=0+$scope.parameters.chartDefinition.stacked,$scope.parameters.maxLabelTop&&($scope.parameters.chartDefinition.label_top=$scope.parameters.maxLabelTop),$scope.parameters.chartDefinition.plots&&($scope.parameters.chartDefinition.plots[0].max_label_top&&($scope.parameters.chartDefinition.plots[0].label_top=$scope.parameters.chartDefinition.plots[0].max_label_top),$scope.parameters.chartDefinition.plots[0].max_label_left&&($scope.parameters.chartDefinition.plots[0].label_left=$scope.parameters.chartDefinition.plots[0].max_label_left)),$scope.parameters.chartDefinition.baseAxisLabel_text=$scope.parameters.baseAxisLabelLongText,$scope.parameters.chartDefinition.legendClickMode=$scope.parameters.legendClickMode,$scope.parameters.chartDefinition.orthoAxisTitle=$scope.parameters.orthoAxisTitle),$scope.parameters.postExecution=function(){navigator.userAgent.match("Android")&&window.screen.width<window.screen.height&&angular.element(".modal .backGraps div[id^=dvt]").css("border","2px solid transparent")},$log.debug("Maximize definition is: "),$log.debug($scope.parameters),$scope.ok=function(){$modalInstance.close("OK CLOSE")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}})}}});