define(function(require){"use strict";function DVTSearchDirective($stateParams){return{restrict:"E",transclude:!0,scope:{},controller:["dataService","mapProvider","configService","$scope","$window","$state","$stateParams","$attrs","$document","$timeout","$log",function(dataService,mapProvider,configService,$scope,$window,$state,$stateParams,$attrs,$document,$timeout,$log){function search($event){var searchInput=$("#search-input").val();$log.debug("searchInput free text: "+searchInput);var queryFunction=dataService[$attrs.searchQuery];$scope.searchTitle&&($scope.searchTitle=!1,queryFunction=dataService[$attrs.titleQuery]),searchInput.indexOf("(")>-1&&(searchInput=searchInput.replace("(","\\(")),searchInput.indexOf(")")>-1&&(searchInput=searchInput.replace(")","\\)")),queryFunction.apply($attrs.searchQuery,[searchInput]).then(function(results){$scope.results=dataService.dataMapper(results),$scope.firstPage()}).catch(function(err){throw err}),$scope.currentPage=0,$scope.elementsStart>9&&($scope.elementsStart=$scope.elementsStart+1),$scope.elementsEnd=$scope.elementsStart+($scope.pageSize-1),$scope.elementsEnd>$scope.results.length&&($scope.elementsEnd=$scope.results.length),$scope.paginationText=$scope.i18n.Displaying+" "+$scope.elementsStart+"-"+$scope.elementsEnd+" "+$scope.i18n.of+" "+$scope.results.length}$scope.isCollapsed=!1,$scope.havefilters=!1,$scope.results=[],$scope.currentPage=0,$scope.pageSize=$attrs.itemsPage||10,$scope.data=[],$scope.elementsStart=1,$scope.elementsEnd=$scope.pageSize,$scope.query="";var href=$window.location.href;if(href.indexOf("?term=")>-1&&($scope.query=href.substring(href.indexOf("?term=")+6),$scope.query=decodeURI($scope.query),$scope.searchTitle=!0,$timeout(function(){angular.element("button#policy-search").triggerHandler("click")},0)),$attrs.itemTemplate){var itemTemplateParams=$attrs.itemTemplate.split(", ");$scope.itemTemplate=configService.getVerticalTplPath(itemTemplateParams[0],itemTemplateParams[1]),$log.debug("search Component vertical item template")}else configService.getHorizontalDirectiveTplPath("search","result-item"),$log.debug("search Component default horizontal item template");var i18n=require("json!horizontal/search/i18n");if($scope.i18n=i18n,$scope.i18nSearchPlaceholder=i18n["search-placeholder"],$attrs.filterLiterals&&$scope.filterQueries&&$scope.filterLiterals.length!=$scope.filterQueries.length)throw"the number of Filter literals & Filter queries must match";if($attrs.filterLiterals&&$attrs.filterQueries){var filterLiterals=$attrs.filterLiterals.split(", "),filterQueries=$attrs.filterQueries.split(", ");if($scope.havefilters=filterQueries.length>0||!1,$scope.filters=[],filterQueries.forEach(function(query,index,array){dataService[query]().then(function(results){$scope.filters.push({name:filterLiterals[index],items:dataService.dataMapper(results)}),$log.debug(JSON.stringify($scope.filters,void 0,2))}).catch(function(err){throw err})}),$attrs.filterTemplate){var filterTemplateParams=$attrs.filterTemplate.split(", ");$scope.filterTemplate=configService.getVerticalTplPath(filterTemplateParams[0],filterTemplateParams[1]),$log.debug("search Component vertical filter template")}else $scope.filterTemplate=configService.getHorizontalDirectiveTplPath("search","filter"),$log.debug("search Component default horizontal filter template")}$scope.toogleFilterClick=function($event,$index){$log.debug("addclassificationClick CLICK");var element=angular.element($event.currentTarget),filterType=element.id.substring(element.id.indexOf("-"));element.prop("checked")?$scope.filters[filterType].push(element.attr("value")):$scope.filters[filterType].splice($scope.filters[filterType].indexOf(element.attr("value")),1),search($event)},$scope.seeMore=function($event,$index){$log.debug("EXPAND CLICK");for(var element=$event.currentTarget.previousSibling;element&&1!=element.nodeType;)element=element.previousSibling;var id="long-description-"+$index,elemento=document.getElementById(id),element2=angular.element(elemento);element2.toggleClass("expanded");var element=angular.element(element);element.toggleClass("hide");var path=configService.getImagesPath();element2.hasClass("expanded")?$event.currentTarget.innerHTML='<img src="'+path+'less.png" alt="See less" class="buttonmoreless">':$event.currentTarget.innerHTML='<img src="'+path+'more.png" alt="See more" class="buttonmoreless">'},$scope.search=search,$scope.clickEnter=function($event){13===$event.which&&search($event)},$scope.clear=function($event){angular.element("#search-input").val(""),$scope.search(),$scope.currentPage=0},$scope.numberOfPages=function(){return Math.ceil($scope.results.length/$scope.pageSize)},$scope.firstPage=function(){$scope.currentPage=0,$scope.elementsStart=1,$scope.elementsEnd=$scope.pageSize,$scope.elementsStart>9&&($scope.elementsStart=$scope.elementsStart+1),$scope.elementsEnd=$scope.elementsStart+($scope.pageSize-1),$scope.elementsEnd>$scope.results.length&&($scope.elementsEnd=$scope.results.length),$scope.paginationText=$scope.i18n.Displaying+" "+$scope.elementsStart+"-"+$scope.elementsEnd+" "+$scope.i18n.of+" "+$scope.results.length},$scope.previousPage=function(){$scope.currentPage>0?($scope.currentPage--,$scope.currentPage>0?($scope.elementsStart=$scope.currentPage*$scope.pageSize,$scope.elementsEnd=$scope.elementsStart+$scope.pageSize):($scope.elementsStart=1,$scope.pageSize<=$scope.results.length?$scope.elementsEnd=$scope.pageSize:$scope.elementsEnd=$scope.results.length)):($scope.currentPage=0,$scope.elementsStart=1,$scope.elementsEnd=$scope.pageSize),$scope.elementsStart>9&&($scope.elementsStart=$scope.elementsStart+1),$scope.elementsEnd=$scope.elementsStart+($scope.pageSize-1),$scope.elementsEnd>$scope.results.length&&($scope.elementsEnd=$scope.results.length),$scope.paginationText=$scope.i18n.Displaying+" "+$scope.elementsStart+"-"+$scope.elementsEnd+" "+$scope.i18n.of+" "+$scope.results.length},$scope.nextPage=function(){$scope.currentPage<$scope.results.length/$scope.pageSize-1&&($scope.currentPage++,$scope.elementsStart=$scope.currentPage*$scope.pageSize,$scope.elementsStart+$scope.pageSize<=$scope.results.length?$scope.elementsEnd=$scope.elementsStart+$scope.pageSize:$scope.elementsEnd=$scope.results.length,$scope.elementsStart>9&&($scope.elementsStart=$scope.elementsStart+1),$scope.elementsEnd=$scope.elementsStart+($scope.pageSize-1),$scope.elementsEnd>$scope.results.length&&($scope.elementsEnd=$scope.results.length),$scope.paginationText=$scope.i18n.Displaying+" "+$scope.elementsStart+"-"+$scope.elementsEnd+" "+$scope.i18n.of+" "+$scope.results.length)},$scope.lastPage=function(){var resto=Math.floor($scope.results.length/$scope.pageSize);$scope.currentPage=resto,$scope.elementsStart=$scope.currentPage*$scope.pageSize,$scope.elementsStart+$scope.pageSize<=$scope.results.length?$scope.elementsEnd=$scope.elementsStart+$scope.pageSize:$scope.elementsEnd=$scope.results.length,$scope.elementsStart>9&&($scope.elementsStart=$scope.elementsStart+1),$scope.elementsEnd=$scope.elementsStart+($scope.pageSize-1),$scope.elementsEnd>$scope.results.length&&($scope.elementsEnd=$scope.results.length),$scope.paginationText=$scope.i18n.Displaying+" "+$scope.elementsStart+"-"+$scope.elementsEnd+" "+$scope.i18n.of+" "+$scope.results.length},$attrs.detailState&&$state.current.name==$attrs.detailState?($log.debug("Search component searchDetailState"),searchPolicyDetail($stateParams.policy)):($log.debug("Search component searchState"),search())}],templateUrl:configService.getHorizontalDirectiveTplPath("search","search")}}var configService=require("horizontal/config/configService");return DVTSearchDirective.$inject=[],DVTSearchDirective});