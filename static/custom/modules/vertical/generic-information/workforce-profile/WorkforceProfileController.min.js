define(function(require){"use strict";function controller($scope,$stateParams,$state,configService,$log,$document,dataService,$window,$sce,$compile,$timeout,dvtUtils,mapProvider,WorkforceProfileService,$rootScope){function search($event){$scope.matrix=[],dataService.getFilteringCountries($scope.datasetEurostat,$scope.countryFilter).then(function(data){data.data.resultset.map(function(elem){$scope.matrix.push({country_code:elem[0]})})}).catch(function(err){throw err})}$scope.cda=configService.getBarometerCda(),$scope.cdaGenericInformation=configService.getGenericInformationCda(),$scope.datasetList=configService.getDatasets(),$scope.datasetEurostat=$scope.datasetList.EUROSTAT2018,$scope.datasetEurostat2019=$scope.datasetList.EUROSTAT2019,$scope.datasetEurostatBetweenDates=$scope.datasetList.EUROSTATBetweenDates;var i18nLiterals=configService.getLiterals();switch($scope.i18nLiterals=i18nLiterals,$scope.selectedIndicator=$stateParams.pIndicator,$scope.selectedSubIndicator=$stateParams.pSubIndicator,$scope.selectedIndicatorLiteral="",$scope.selectedIndicator){case"median-age":$scope.selectedIndicatorLiteral=i18nLiterals.L294;break;case"employment-rate":switch($scope.selectedSubIndicator){case"ageing-workers":$scope.selectedIndicatorLiteral=i18nLiterals.L20621+" - "+i18nLiterals.L295;break;case"Female":$scope.selectedIndicatorLiteral=i18nLiterals.L20621+" - "+i18nLiterals.L444;break;case"Male":$scope.selectedIndicatorLiteral=i18nLiterals.L20621+" - "+i18nLiterals.L443;break;case"Total":$scope.selectedIndicatorLiteral=i18nLiterals.L20621+" - "+i18nLiterals.L442;break;default:$scope.selectedIndicatorLiteral=i18nLiterals.L20621+" - "+i18nLiterals.L295}break;case"unemployment-rate":$scope.selectedIndicatorLiteral=i18nLiterals.L291;break;default:$scope.selectedIndicatorLiteral=i18nLiterals.L294}$scope.genders=[],$scope.countries=[],$scope.countryFilter=[],$scope.matrix=[],$scope.dashboard={},$scope.dashboard.parameters={pEurope:"EU",color1:dvtUtils.getGroupColor("1"),color2:dvtUtils.getGroupColor("2"),color3:dvtUtils.getGroupColor("3"),color4:dvtUtils.getGroupColor("4")},$scope.promises={promiseShape:mapProvider.getEuropeShape()},$scope.dataPromises=[mapProvider.getEuropeShape(),dataService.getMedianAgeData($scope.datasetEurostat2019),dataService.getAgeingWorkersData($scope.datasetEurostat),dataService.getTotalEmploymentData($scope.datasetEurostat),dataService.getMaleEmploymentData($scope.datasetEurostat),dataService.getFemaleEmploymentData($scope.datasetEurostat),dataService.getUnemploymentData($scope.datasetEurostat)],$scope.stories=[{color1:dvtUtils.getColorCountry(2),plots:WorkforceProfileService.getMinMaxValues(),dimensions:{value:{format:{number:"#"}}}}],$scope.step={chart1:5},void 0!=$rootScope.data&&($rootScope.data.indicator=$scope.selectedIndicator,$rootScope.data.subIndicator=$scope.selectedSubIndicator),$scope.data={medianAge:[],ageingWorkers:[],totalEmployment:[],maleEmployment:[],femaleEmployment:[],unemploymentRate:[]},"median-age"==$scope.selectedIndicator?($scope.pIndicator=37,$scope.pSubIndicator=0):"employment-rate"==$scope.selectedIndicator&&"ageing-workers"==$scope.selectedSubIndicator?($scope.pIndicator=38,$scope.pSubIndicator=0):"employment-rate"==$scope.selectedIndicator&&"Total"==$scope.selectedSubIndicator?($scope.pIndicator=39,$scope.pSubIndicator=1):"employment-rate"==$scope.selectedIndicator&&"Male"==$scope.selectedSubIndicator?($scope.pIndicator=39,$scope.pSubIndicator=2):"employment-rate"==$scope.selectedIndicator&&"Female"==$scope.selectedSubIndicator?($scope.pIndicator=39,$scope.pSubIndicator=3):"unemployment-rate"==$scope.selectedIndicator&&"ageing-workers"==$scope.selectedSubIndicator&&($scope.pIndicator=34,$scope.pSubIndicator=0),$scope.minMaxValues={minValue:0,maxValue:100,range:25},$scope.openSelect=function($event){var currentSelect=$event.target,nodename=currentSelect.nodeName;"LABEL"==nodename||"INPUT"==nodename?(currentSelect=$event.target.offsetParent.offsetParent,angular.element(currentSelect).addClass("viewOptions")):(currentSelect=$event.target.offsetParent.offsetParent,$scope.checkSelect(currentSelect))},$scope.checkSelect=function(elem){elem.className.indexOf("viewOptions")>0?angular.element(elem).removeClass("viewOptions"):(angular.element(".filter--dropdown--wrapper").removeClass("viewOptions"),angular.element(elem).addClass("viewOptions"))},angular.element("div.countries-filters").css("display","none"),angular.element("#filter3 h2").addClass("showChallenges"),$scope.toggleFilters=function(){$window.outerWidth<768&&(angular.element("#filter3 h2").toggleClass("showChallenges"),angular.element("div.countries-filters").slideToggle("slow"))},$scope.selectedCountry="",$scope.countryClick=function(){$scope.selectedCountry=this.id;for(var i=0;i<$scope.countries.length;i++)$scope.countries[i].country_code==$scope.selectedCountry&&($scope.selectedCountryName="L"+$scope.countries[i].country_name);angular.element("path.active").length>0&&(angular.element(".survey--map--block-mobile .matrix--elements--wrapper .matrix--element").removeClass("active"),angular.element("path.active").attr("class","")),"text"!=this.node.tagName&&"tspan"!=this.node.tagName||this.node.previousElementSibling.classList.add("active"),this.node.classList.add("active"),angular.element(".survey--map--block-mobile .matrix--elements--wrapper .matrix--element").addClass("no-print"),angular.element(".survey--map--block-mobile .matrix--elements--wrapper .eu28").removeClass("no-print"),angular.element(".survey--map--block-mobile .matrix--elements--wrapper ."+$scope.selectedCountry.toLowerCase()).addClass("active").removeClass("no-print"),$scope.$apply()},$scope.clearCountry=function(){angular.element(".survey--map--block-mobile .matrix--elements--wrapper ."+$scope.selectedCountry.toLowerCase()).removeClass("active"),angular.element(".survey--map--block-mobile .matrix--elements--wrapper .matrix--element").removeClass("no-print"),$scope.selectedCountry="",angular.element("path.active").attr("class","")},$scope.getMinMaxValues=function(){var data;"median-age"==$scope.selectedIndicator?data=$scope.data.medianAge:"employment-rate"==$scope.selectedIndicator&&"ageing-workers"==$scope.selectedSubIndicator?data=$scope.data.ageingWorkers:"employment-rate"==$scope.selectedIndicator&&"Total"==$scope.selectedSubIndicator?data=$scope.data.totalEmployment:"employment-rate"==$scope.selectedIndicator&&"Male"==$scope.selectedSubIndicator?data=$scope.data.maleEmployment:"employment-rate"==$scope.selectedIndicator&&"Female"==$scope.selectedSubIndicator?data=$scope.data.femaleEmployment:"unemployment-rate"==$scope.selectedIndicator&&(data=$scope.data.unemploymentRate);var minValue=100,maxValue=0;if(void 0!=data){for(var index in data)data[index].value<minValue&&(minValue=data[index].value),data[index].value>maxValue&&(maxValue=data[index].value);var range=(maxValue-minValue)/4;$scope.minMaxValues={min_value:minValue,max_value:maxValue,range_value:range},$scope.steps=[minValue,minValue+range,minValue+2*range,minValue+3*range,maxValue]}else console.log("The indicator selected is not known")},void 0==$rootScope.data?Promise.all([$scope.dataPromises[1],$scope.dataPromises[2],$scope.dataPromises[3],$scope.dataPromises[4],$scope.dataPromises[5],$scope.dataPromises[6]]).then(function(res){var row={};res[0].data.resultset.map(function(elem){row=elem,$scope.data.medianAge[row[0]]||($scope.data.medianAge[row[0]]={}),$scope.data.medianAge[row[0]].country_name=row[1],$scope.data.medianAge[row[0]].value=row[2]});var row={};res[1].data.resultset.map(function(elem){row=elem,$scope.data.ageingWorkers[row[0]]||($scope.data.ageingWorkers[row[0]]={}),$scope.data.ageingWorkers[row[0]].country_name=row[1],$scope.data.ageingWorkers[row[0]].value=row[2]});var row={};res[2].data.resultset.map(function(elem){row=elem,$scope.data.totalEmployment[row[0]]||($scope.data.totalEmployment[row[0]]={}),$scope.data.totalEmployment[row[0]].country_name=row[1],$scope.data.totalEmployment[row[0]].value=row[2]});var row={};res[3].data.resultset.map(function(elem){row=elem,$scope.data.maleEmployment[row[0]]||($scope.data.maleEmployment[row[0]]={}),$scope.data.maleEmployment[row[0]].country_name=row[1],$scope.data.maleEmployment[row[0]].value=row[2]});var row={};res[4].data.resultset.map(function(elem){row=elem,$scope.data.femaleEmployment[row[0]]||($scope.data.femaleEmployment[row[0]]={}),$scope.data.femaleEmployment[row[0]].country_name=row[1],$scope.data.femaleEmployment[row[0]].value=row[2]});var row={};res[5].data.resultset.map(function(elem){row=elem,$scope.data.unemploymentRate[row[0]]||($scope.data.unemploymentRate[row[0]]={}),$scope.data.unemploymentRate[row[0]].country_name=row[1],$scope.data.unemploymentRate[row[0]].value=row[2]}),$scope.data.indicator=$scope.selectedIndicator,$scope.data.subIndicator=$scope.selectedSubIndicator,$scope.getMinMaxValues(),$state.reload()}):($scope.data=$rootScope.data,$scope.getMinMaxValues()),dataService.getGenders().then(function(data){data.data.resultset.map(function(elem){$scope.genders.push({gender_id:elem[0],gender_name:elem[1]})})}).catch(function(err){throw err}),dataService.getAvailableCountries($scope.datasetEurostat).then(function(data){data.data.resultset.map(function(elem){$scope.countries.push({country_code:elem[0],country_name:elem[1]}),$scope.matrix.push({country_code:elem[0]})})}).catch(function(err){throw err}),$scope.selectChange=function(){void 0!==$state.current.name&&$state.go($state.current.name,{pIndicator:$scope.selectedIndicator,pSubIndicator:$scope.selectedSubIndicator})},$scope.toggleCountryClick=function($event,$index){var element=angular.element($event.currentTarget),tags=angular.element("div.selected--tags-wrapper"),valueToJson=JSON.parse(element.attr("value"));element.prop("checked")?$scope.countryFilter.push(valueToJson.country_name):($scope.countryFilter.splice($scope.countryFilter.indexOf(valueToJson.country_name),1),angular.element("span#country"+valueToJson.country_name).remove());for(var tags=angular.element("div.selected--tags-wrapper"),i=0;i<$scope.countryFilter.length;i++)if(angular.element("span#country"+$scope.countryFilter[i]).length<=0){if("EU28"==valueToJson.country_code)var html='<span class="selected-tag" id="country'+$scope.countryFilter[i]+'" data-ng-click="deleteTag($event)">'+$scope.i18nLiterals["L"+$scope.countryFilter[i]]+"</span>";else var html='<span class="selected-tag" id="country'+$scope.countryFilter[i]+'" data-ng-click="deleteTag($event)">('+valueToJson.country_code+") "+$scope.i18nLiterals["L"+$scope.countryFilter[i]]+"</span>";tags.append($compile(html)($scope))}search($event)},$scope.confirmSelection=function($event){var tags=angular.element("div.selected--tags-wrapper");tags.empty(),$scope.countryFilter.sort();for(var i=0;i<$scope.countryFilter.length;i++){var html='<span class="selected-tag" id="country'+$scope.countryFilter[i]+'" data-ng-click="deleteTag($event)">'+$scope.i18nLiterals["L"+$scope.countryFilter[i]]+"</span>";tags.append($compile(html)($scope))}search($event)},$scope.deleteTag=function($event){var quitChecked,element=angular.element($event.currentTarget),countryId=element[0].id.slice(7,10);-1!=$event.target.id.indexOf("country")&&($scope.countryFilter.splice($scope.countryFilter.indexOf(countryId),1),quitChecked=angular.element(".filter--dropdown--options #country-filter-"+countryId)),element.remove(),quitChecked.prop("checked",!1),search($event)},$(window).scroll(function(){var element=$(".survey--map--block"),offset=element.offset();$(this).scrollTop()>=offset.top?$(".survey--map--block").addClass("fixed"):$(".survey--map--block").removeClass("fixed")}),$scope.status="ready"}return controller.$inject=["$scope","$stateParams","$state","configService","$log","$document","dataService","$window","$sce","$compile","$timeout","dvtUtils","mapProvider","WorkforceProfileService","$rootScope"],controller});