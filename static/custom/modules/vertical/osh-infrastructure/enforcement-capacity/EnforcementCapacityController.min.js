var resolution=screen.width;define(function(require){"use strict";function controller($scope,$stateParams,$state,configService,dvtUtils,$log,$document,dataService,$window,$sce,$compile,$timeout,EnforcementCapacityService,$rootScope){$scope.cda=configService.getOshInfraestructureCda(),$scope.cdaGenericInformation=configService.getGenericInformationCda();var i18nLiterals=configService.getLiterals();$scope.i18nLiterals=i18nLiterals,$scope.datasetList=configService.getDatasets(),$scope.datasetESENER=$scope.datasetList.ESENER,$scope.countriesDataFor=[],$scope.countriesCompareWith=[],$scope.indicators=[],$scope.country1Data={},$scope.country2Data={},null!=$stateParams.pCountry1?$scope.pCountry1=$stateParams.pCountry1:void 0!=$rootScope.defaultCountry?$scope.pCountry1=$rootScope.defaultCountry.code:$scope.pCountry1=$rootScope.defaultCountryDefaultValue,null!=$stateParams.pCountry2?$scope.pCountry2=$stateParams.pCountry2:void 0!=$rootScope.defaultCountry2?$scope.pCountry2=$rootScope.defaultCountry2.code:$scope.pCountry2="0",$scope.pIndicator=$stateParams.pIndicator,$scope.indicatorParam=$scope.pIndicator,"establishments-inspected"==$scope.pIndicator?$scope.indicatorParam="%-of-establishments-inspected":"strategy-plan"==$scope.pIndicator&&($scope.indicatorParam="strategy/plan"),$scope.dashboard={parameters:{pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2}},$scope.relatedItems={"establishments-inspected":[{title:"L310",text:"L22050",link:"work-accidents",icon:"work-accidents"},{title:"L311",text:"L22050",link:"work-accidents({pIndicator:'fatal-work-accidents'})",icon:"work-accidents"},{title:"L20679",text:"L22058",link:"prevention-companies",icon:"prevention"}],authority:[{title:"L22002",text:"L22025",link:"osh-authorities",icon:"forum"}],"scope-of-the-labor-inspection":[{title:"L22002",text:"L22025",link:"osh-authorities",icon:"forum"},{title:"L22018",text:"L22065",link:"osh-statistics",icon:"statistics"}],"inspector-powers":[{title:"L22002",text:"L22025",link:"osh-authorities",icon:"forum"},{title:"L22007",text:"L22038",link:"national-strategies",icon:"national"}],"strategy-plan":[{title:"L22007",text:"L22038",link:"national-strategies",icon:"national"}]},$scope.maxCharacters=200,$scope.step=20,$scope.already=!1,$scope.already2=!1,$scope.compileText=function(text,num){if(null!=text)if(0==$scope.already&&1==num){var auth=angular.element("#tab2 .first .columm--item--content");auth.append($compile(text)($scope)),$scope.already=!0}else if(0==$scope.already2&&2==num){var auth2=angular.element("#tab2 .second .columm--item--content");auth2.append($compile(text)($scope)),$scope.already2=!0}},$scope.trimText=function(pVal,pNumCharacters){var shortText=pVal,newMaxCharacter=pNumCharacters;if(null!=shortText){shortText.substring(0,newMaxCharacter).match("<a")&&(pNumCharacters+=150);var indexStart=shortText.indexOf("<a"),indexEnd=shortText.indexOf(">",indexStart);if(-1!=indexStart)for(;-1!=indexStart;){var link=shortText.substring(indexStart,indexEnd);newMaxCharacter+=link.length,indexStart=shortText.indexOf("<a",indexEnd),indexEnd=shortText.indexOf(">",indexStart)}return shortText.length>newMaxCharacter&&(shortText=$.trim(shortText).substring(0,pNumCharacters).split(" ").slice(0,-1).join(" ")+"<span class='dots'>...</span>"),$sce.trustAsHtml(shortText)}},$scope.toggleText=function($event){$(this).is(":visible")&&(angular.element("div.complete-text",angular.element($event.target).parent().parent()).toggle(),angular.element("div.partial-text",angular.element($event.target).parent().parent()).toggle()),angular.element(" span.dots",angular.element($event.target).parent().parent()).toggle(),angular.element(" a",angular.element($event.target).parent()).toggle()},$scope.stories=[{color1:dvtUtils.getColorCountry(1),color2:"0"==$scope.pCountry2?dvtUtils.getColorCountry():dvtUtils.getColorCountry(2),color3:dvtUtils.getColorCountry(),plots:EnforcementCapacityService.getGeneralOSHInfrastructurePlot($scope.pCountry1,$scope.pCountry2),dimensions:{value:{format:{number:"0.#",percent:"#%"}}},labelTextAlign:"left"}],dataService.getEnforcementCapacityIndicators().then(function(data){data.data.resultset.map(function(elem){$stateParams.filter&&$stateParams.filter;126==elem[0]?$scope.indicators.push({id:elem[0],anchor:"establishments-inspected",text:"20692"}):79==elem[0]?$scope.indicators.push({id:elem[0],anchor:"strategy-plan",text:elem[1]}):$scope.indicators.push({id:elem[0],anchor:i18nLiterals["L"+elem[1]].toLowerCase().replace(/ /g,"-"),text:elem[1]})})}).catch(function(err){throw err}),dataService.getEnforcementCapacityData($scope.pCountry1).then(function(data){data.data.resultset.map(function(elem){$scope.country1Data={country_code:elem[0],country_name:elem[1],authority:i18nLiterals["L"+elem[2]],scope:elem[3],inspector:elem[4],strategy:elem[5]}})}).catch(function(err){throw err}),dataService.getEnforcementCapacityData($scope.pCountry2).then(function(data){data.data.resultset.map(function(elem){$scope.country2Data={country_code:elem[0],country_name:elem[1],authority:i18nLiterals["L"+elem[2]],scope:elem[3],inspector:elem[4],strategy:elem[5]}})}).catch(function(err){throw err}),$scope.countryChange=function(){void 0!==$state.current.name&&($rootScope.defaultCountry.isCookie||($rootScope.defaultCountry.code=$scope.pCountry1),"0"!=$scope.pCountry2&&($rootScope.defaultCountry2={code:$scope.pCountry2,isCookie:0}),$state.go($state.current.name,{pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2,pIndicator:$scope.pIndicator}))},$(window).on("resize",function(e){resolution=screen.width}),$scope.openIndicatorsList=function(e){var parentTag=e.target.parentNode.className;if(parentTag.indexOf("submenu--items--wrapper")>=0)var parentTag=e.target.parentNode.className;else var parentTag=e.target.offsetParent.nextSibling.parentNode.className;resolution<990&&(parentTag.indexOf("open-list")<0?angular.element(".submenu--items--wrapper").addClass("open-list"):angular.element(".submenu--items--wrapper").removeClass("open-list"))},$("body").on("click touchstart",function(e){var container=angular.element(".submenu--items--wrapper");container.is(e.target)||0!==container.has(e.target).length||angular.element(".submenu--items--wrapper").removeClass("open-list")}),$scope.changeIndicator=function(e,indicator){void 0!==$state.current.name&&$state.go($state.current.name,{pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2,pIndicator:indicator})}}return controller.$inject=["$scope","$stateParams","$state","configService","dvtUtils","$log","$document","dataService","$window","$sce","$compile","$timeout","EnforcementCapacityService","$rootScope"],controller});