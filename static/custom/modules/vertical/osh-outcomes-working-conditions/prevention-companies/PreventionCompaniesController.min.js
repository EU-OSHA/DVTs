var resolution=screen.width;define(function(require){"use strict";function controller($scope,$stateParams,$state,configService,$log,$document,dataService,$window,$sce,$compile,$timeout,dvtUtils,PreventionCompaniesService,$rootScope){$scope.cdaOSHOutcomes=configService.getOshOutcomesWorkingConditionsCda();var i18nLiterals=configService.getLiterals();$scope.i18nLiterals=i18nLiterals,$scope.datasetList=configService.getDatasets(),$scope.datasetEurofound=$scope.datasetList.Eurofound,$scope.datasetESENER=$scope.datasetList.ESENER,null!=$stateParams.pCountry1?$scope.pCountry1=$stateParams.pCountry1:void 0!=$rootScope.defaultCountry.code?$scope.pCountry1=$rootScope.defaultCountry.code:$scope.pCountry1=$rootScope.defaultCountryDefaultValue,console.log($scope.pCountry1),null!=$stateParams.pCountry2?$scope.pCountry2=$stateParams.pCountry2:void 0!=$rootScope.defaultCountry2?$scope.pCountry2=$rootScope.defaultCountry2.code:$scope.pCountry2="0",$scope.pSplit=null!=$stateParams.pSplit?$stateParams.pSplit:"sector",$log.warn($scope.pSplit),$scope.countriesDataFor=[],$scope.countriesCompareWith=[],$scope.indicators=[],$scope.relatedLiterals=[20679,20680,20681,20682];var resolution=window.resolution;$scope.resolution=resolution,$scope.orientation=resolution>768?"vertical":"horizontal",$scope.axisSize=resolution>768?150:110,$scope.angle=resolution>768?1:0,$scope.horizontalHeight=resolution>768?470:770,$scope.oshInformationQuery=resolution>768?"getOshInformationVerticalData":"getOshInformationHorizontalData",$scope.internalQuery=resolution>768?"getInternalExternalRAVerticalData":"getInternalExternalRAHorizontalData",$scope.color1=resolution>768?dvtUtils.getColorCountry(22):dvtUtils.getColorCountry(1),$scope.color2=resolution>768?dvtUtils.getColorCountry(1):dvtUtils.getColorCountry(22),$scope.color3=resolution>768?dvtUtils.getAccidentsColors(4):dvtUtils.getColorCountry(1),$scope.color4=resolution>768?dvtUtils.getColorCountry(1):dvtUtils.getAccidentsColors(4),$scope.axisSizeRA=resolution>768?60:90,$scope.axisWordBreak=resolution>768?1:"",$(window).on("resize",function(e){window.outerWidth!=resolution&&(resolution=window.resolution,$state.reload())}),$scope.pIndicator=$stateParams.pIndicator,$scope.dashboard={},$scope.dashboard={parameters:{pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2}},$scope.relatedItems={"risk-assessment":[{title:"L20692",text:"L22063",link:"enforcement-capacity",icon:"enforcement"},{title:"L20681",text:"L22058",link:"prevention-companies({pIndicator:'evaluated-aspects-in-risk-assessments'})",icon:"prevention"}],"internal-or-external-ra":[{title:"L20692",text:"L22063",link:"enforcement-capacity",icon:"enforcement"},{title:"L20681",text:"L22058",link:"prevention-companies({pIndicator:'evaluated-aspects-in-risk-assessments'})",icon:"prevention"}],"evaluated-aspects-in-risk-assessments":[{title:"L20692",text:"L22063",link:"enforcement-capacity",icon:"enforcement"}],"training-in-osh":[{title:"L22012",text:"L22054",link:"osh-culture",icon:"culture"},{title:"L22008",text:"L22041",link:"social-dialogue",icon:"dialogue"}],"employees-participation-in-prevention":[{title:"L22015",text:"L22060",link:"worker-involvement",icon:"workers"},{title:"L22011",text:"L22052",link:"health-perception-of-workers",icon:"enforcement"}]};$scope.stories=[{color1:dvtUtils.getColorCountry(1),color2:"0"==$scope.pCountry2?dvtUtils.getEUColor():dvtUtils.getColorCountry(2),color3:dvtUtils.getEUColor(),plotsVertical:PreventionCompaniesService.getRiskAssessmentSplitVertical($scope.pCountry1,$scope.pCountry2),plotsHorizontal:PreventionCompaniesService.getRiskAssessmentSplitHorizontal($scope.pCountry1,$scope.pCountry2),dimensions:{value:{format:{number:"0.#"}}}},{color1:dvtUtils.getColorCountry(1),color2:dvtUtils.getColorCountry(22),color3:dvtUtils.getAccidentsColors(4),plots:PreventionCompaniesService.getInternalExternalRAPlots(),dimensions:{value:{format:{number:"0.#",percent:"#%"}}}}],$scope.riskAssesmentPlots=resolution>768?$scope.stories[0].plotsVertical:$scope.stories[0].plotsHorizontal,$scope.alignment=resolution>768?"center":"left",$scope.step={chart1:20,chart2:20},angular.element("div.countries-filters").css("display","none"),angular.element("#filter2 h2").addClass("showChallenges"),$scope.toggleFilters=function(){$window.outerWidth<768&&(angular.element("#filter2 h2").toggleClass("showChallenges"),angular.element("div.countries-filters").slideToggle("slow"))},console.log("column--item --\x3e"+angular.element(".column--item").length),angular.element("div.countries-filters").css("display","none"),angular.element("#filter2 h2").addClass("showChallenges"),$scope.toggleFilters=function(){$window.outerWidth<768&&(angular.element("#filter2 h2").toggleClass("showChallenges"),angular.element("div.countries-filters").slideToggle("slow"))},dataService.getPreventionCompaniesIndicators().then(function(data){var index=0;data.data.resultset.map(function(elem){$scope.indicators.push({id:elem[0],anchor:i18nLiterals["L"+$scope.relatedLiterals[index]].toLowerCase().replace(/[\,\ ]/g,"-"),text:$scope.relatedLiterals[index]}),index++})}).catch(function(err){throw err}),dataService.getPreventionCompaniesCountries($scope.datasetESENER).then(function(data){data.data.resultset.map(function(elem){elem[1]!=$scope.pCountry2&&$scope.countriesDataFor.push({country:elem[0],country_code:elem[1]}),elem[1]!=$scope.pCountry1&&$scope.countriesCompareWith.push({country:elem[0],country_code:elem[1]})})}).catch(function(err){throw err}),$scope.openIndicatorsList=function(e){var parentTag=e.target.parentNode.className;if(parentTag.indexOf("submenu--items")>=0)var parentTag=e.target.parentNode.className;else var parentTag=e.target.offsetParent.nextSibling.parentNode.className;resolution<990&&(parentTag.indexOf("open-list")<0?angular.element(".submenu--items--wrapper").addClass("open-list"):angular.element(".submenu--items--wrapper").removeClass("open-list"))},$("body").on("click touchstart",function(e){var container=angular.element(".submenu--items--wrapper");container.is(e.target)||0!==container.has(e.target).length||angular.element(".submenu--items--wrapper").removeClass("open-list")}),$scope.changeIndicator=function(e,indicator){void 0!==$state.current.name&&("risk-assessment"==indicator||"employees-participation-in-prevention"==indicator?$state.go($state.current.name,{pIndicator:indicator,pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2,pSplit:$scope.pSplit}):$state.go("prevention-companies-tabs",{pIndicator:indicator,pSplit:$scope.pSplit}))},$scope.countryChange=function(){$(".card--block--chart--wrapper").css("visibility","hidden"),void 0!==$state.current.name&&($rootScope.defaultCountry.isCookie||($rootScope.defaultCountry.code=$scope.pCountry1),"0"!=$scope.pCountry2&&($rootScope.defaultCountry2={code:$scope.pCountry2,isCookie:0}),$scope.dashboard.parameters={pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2},$state.transitionTo("prevention-companies",{pIndicator:$scope.pIndicator,pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2,pSplit:$scope.pSplit},{reload:!0}))}}return controller.$inject=["$scope","$stateParams","$state","configService","$log","$document","dataService","$window","$sce","$compile","$timeout","dvtUtils","PreventionCompaniesService","$rootScope"],controller});