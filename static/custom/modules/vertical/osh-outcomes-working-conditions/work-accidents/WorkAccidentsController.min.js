var resolution=screen.width;define(function(require){"use strict";function controller($scope,$stateParams,$state,configService,$log,$document,dataService,$window,$sce,$compile,$timeout,dvtUtils,WorkAccidentsService,$rootScope){$scope.cdaOSHOutcomes=configService.getOshOutcomesWorkingConditionsCda(),$scope.cdaGenericInformation=configService.getGenericInformationCda();var i18n=require("json!vertical/osh-authorities/i18n"),i18nLiterals=configService.getLiterals();$scope.i18n=i18n,$scope.i18nLiterals=i18nLiterals,$scope.datasetList=configService.getDatasets(),$scope.datasetEurostat=$scope.datasetList.EUROSTAT,$scope.datasetEurostat2016=$scope.datasetList.EUROSTAT2016,$scope.datasetEurostatBetweenDates=$scope.datasetList.EUROSTAT2017BetweenDates,$scope.countriesDataFor=[],$scope.countriesCompareWith=[],$scope.indicators=[],$scope.country1Data={},$scope.country2Data={},null!=$stateParams.pCountry1?$scope.pCountry1=$stateParams.pCountry1:void 0!=$rootScope.defaultCountry.code?$scope.pCountry1=$rootScope.defaultCountry.code:$scope.pCountry1=$rootScope.defaultCountryDefaultValue,null!=$stateParams.pCountry2?$scope.pCountry2=$stateParams.pCountry2:void 0!=$rootScope.defaultCountry2?$scope.pCountry2=$rootScope.defaultCountry2.code:$scope.pCountry2="0",$scope.pIndicator=$stateParams.pIndicator;var resolution=window.resolution;$scope.orientation=resolution>768?"vertical":"horizontal",$scope.axisSize=resolution>768?150:resolution>480?160:120,$scope.axisSizeSmaller=resolution>768?150:resolution>480?110:100,$(window).on("resize",function(e){window.outerWidth!=resolution&&(resolution=window.resolution,$state.reload())}),$scope.dashboard={},$scope.dashboard={parameters:{pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2}},$scope.relatedItems={"non-fatal-work-accidents":[{title:"L20669",text:"L20578",link:"mental-risk",icon:"mental-risk"},{title:"L20711",text:"L20579",link:"physical-risk-vibrations-loud-noise-and-temperature({pCountry1:'"+$scope.pCountry1+"',pCountry2:'"+$scope.pCountry2+"'})",icon:"physical-risk"},{title:"L20692",text:"L22063",link:"enforcement-capacity",icon:"enforcement"}],"fatal-work-accidents":[{title:"L20672",text:"L20578",link:"mental-risk({pIndicator:'fear-of-job-loss'})",icon:"mental-risk"},{title:"L20692",text:"L22063",link:"enforcement-capacity",icon:"enforcement"}]};$scope.getMin=function(cdaData){for(var minTrunc=0,i=0;i<cdaData.resultset.length;i++){var value=cdaData.resultset[i][2];0==minTrunc?minTrunc=Math.trunc(value/20):Math.trunc(value/20)<minTrunc&&(minTrunc=Math.trunc(value/20))}var options=this.chartDefinition;return options.orthoAxisOriginIsZero=!1,options.orthoAxisFixedMin=20*minTrunc<60?20*minTrunc:60,cdaData},$scope.stories=[{color1:dvtUtils.getColorCountry(1),color2:"0"==$scope.pCountry2?dvtUtils.getEUColor():dvtUtils.getColorCountry(2),color3:dvtUtils.getEUColor(),plots:WorkAccidentsService.getNonFatalAccidentsMainPlots($scope.pCountry1),dimensions:{value:{format:{number:"0.#",percent:"#%"}}}},{color1:dvtUtils.getColorCountry(2),color2:dvtUtils.getEUColor(),plots:WorkAccidentsService.getNonFatalAccidentsMainPlots($scope.pCountry2),dimensions:{value:{format:{number:"0.#",percent:"#%"}}}},{color1:dvtUtils.getColorCountry(2),color2:dvtUtils.getEUColor(),plots:WorkAccidentsService.getFatalAccidentsMainPlots(),dimensions:{value:{format:{number:"0.#"}}}},{color1:dvtUtils.getColorCountry(2),color2:dvtUtils.getAccidentsColors(4),plots:WorkAccidentsService.getEstimationNonFatalAccidentsPlots(),calculations:WorkAccidentsService.getBarDotCalculations(),dimensions:{value:{format:{number:"0.#"}}}}],$scope.step={chart1:20,chart2:20,chart3:1,chart4:1e3,chart5:20},dataService.getWorkAccidentsIndicators().then(function(data){data.data.resultset.map(function(elem){55==elem[0]?$scope.indicators.push({id:elem[0],anchor:i18nLiterals.L20707.toLowerCase().replace(/[\,\ ]/g,"-"),text:"20707"}):$scope.indicators.push({id:elem[0],anchor:i18nLiterals["L"+elem[1]].toLowerCase().replace(/[\,\ ]/g,"-"),text:elem[1]})})}).catch(function(err){throw err}),$scope.countryChange=function(pChangeRoot){void 0!==$state.current.name&&(!$rootScope.defaultCountry.isCookie&&pChangeRoot&&($rootScope.defaultCountry.code=$scope.pCountry1),"0"!=$scope.pCountry2&&pChangeRoot&&($rootScope.defaultCountry2={code:$scope.pCountry2,isCookie:0}),$scope.dashboard.parameters={pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2},$state.transitionTo("work-accidents",{pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2},{reload:!0}))},$(window).on("resize",function(e){resolution=$(window).width()}),resolution=$(window).width(),$scope.openIndicatorsList=function(e){if(resolution<990){if("LI"==e.target.parentElement.nodeName)var parentTag=e.target.parentElement.parentElement.className;else var parentTag=e.target.parentElement.className;parentTag.indexOf("open-list")<0?angular.element(".submenu--items--wrapper").addClass("open-list"):angular.element(".submenu--items--wrapper").removeClass("open-list")}},$("body").on("click touchstart",function(e){var container=angular.element(".submenu--items--wrapper");container.is(e.target)||0!==container.has(e.target).length||angular.element(".submenu--items--wrapper").removeClass("open-list")}),$scope.changeIndicator=function(e,indicator){console.log("INDICATOR CHANGE"),console.log(indicator),console.log($state.current.name),void 0!==$state.current.name&&$state.go($state.current.name,{pIndicator:indicator,pCountry1:"",pCountry2:""})}}return controller.$inject=["$scope","$stateParams","$state","configService","$log","$document","dataService","$window","$sce","$compile","$timeout","dvtUtils","WorkAccidentsService","$rootScope"],controller});