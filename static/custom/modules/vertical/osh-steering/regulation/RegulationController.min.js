var resolution=screen.width;define(function(require){"use strict";function controller($scope,$stateParams,$state,configService,$log,$document,dataService,$window,$sce,$compile,$timeout){$scope.cda=configService.getBarometerCda();var i18n=require("json!vertical/osh-authorities/i18n"),i18nLiterals=configService.getLiterals();if($scope.i18n=i18n,$scope.i18nLiterals=i18nLiterals,$scope.countriesDataFor=[],$scope.countriesCompareWith=[],$scope.indicators=[],$scope.country1Data={},$scope.country2Data={},$scope.pCountry1=$stateParams.pCountry1,$scope.pCountry2=$stateParams.pCountry2,$scope.pIndicator=$stateParams.pIndicator,$scope.maxCharacters=200,angular.element("div.countries-filters").css("display","none"),angular.element("#filter2 h2").addClass("showChallenges"),$scope.toggleFilters=function(){$window.outerWidth<768&&(angular.element("#filter2 h2").toggleClass("showChallenges"),angular.element("div.countries-filters").slideToggle("slow"))},$scope.trimText=function(pVal,pNumCharacters){var shortText=pVal,newMaxCharacter=pNumCharacters;if(null!=shortText){return shortText.substring(0,newMaxCharacter).match("<a")&&(newMaxCharacter+=150),shortText.length>pNumCharacters&&(shortText=$.trim(shortText).substring(0,newMaxCharacter).split(" ").slice(0,-1).join(" ")+"<span class='dots'>...</span>"),$sce.trustAsHtml(shortText)}},$scope.toggleText=function($event){$(this).is(":visible")&&("A"==$event.target.nodeName?(angular.element("div.complete-text",angular.element($event.target).parent().parent()).toggle(),angular.element("div.partial-text",angular.element($event.target).parent().parent()).toggle(),angular.element(" span.dots",angular.element($event.target).parent().parent()).toggle(),angular.element(" a",angular.element($event.target).parent()).toggle()):"FONT"==$event.target.nodeName?(angular.element("div.complete-text",angular.element($event.target).parent().parent().parent().parent()).toggle(),angular.element("div.partial-text",angular.element($event.target).parent().parent().parent().parent()).toggle(),angular.element(" span.dots",angular.element($event.target).parent().parent().parent().parent()).toggle(),angular.element(" a",angular.element($event.target).parent().parent().parent()).toggle()):"I"==$event.target.nodeName&&(angular.element("div.complete-text",angular.element($event.target).parent().parent().parent()).toggle(),angular.element("div.partial-text",angular.element($event.target).parent().parent().parent()).toggle(),angular.element(" span.dots",angular.element($event.target).parent().parent().parent()).toggle(),angular.element(" a",angular.element($event.target).parent().parent()).toggle()))},dataService.getRegulationsCountries($scope.pCountry2).then(function(data){data.data.resultset.map(function(elem){$stateParams.filter&&$stateParams.filter;elem[1]!=$scope.pCountry2&&$scope.countriesDataFor.push({country:elem[0],country_code:elem[1]}),elem[1]!=$scope.pCountry1&&$scope.countriesCompareWith.push({country:elem[0],country_code:elem[1]})})}).catch(function(err){throw err}),dataService.getRegulationIndicators().then(function(data){data.data.resultset.map(function(elem){$stateParams.filter&&$stateParams.filter;$scope.indicators.push({id:elem[0],anchor:i18nLiterals["L"+elem[1]].toLowerCase().replace(/ /g,"-"),text:elem[1]})})}).catch(function(err){throw err}),dataService.getCountryRegulationData($scope.pCountry1).then(function(data){data.data.resultset.map(function(elem){$scope.country1Data={country_code:elem[0],country_name:elem[1],text1:elem[2],text2:elem[3],text3:elem[4],text4:elem[5],text5:elem[6],text6:elem[7],text7:elem[8],text8:elem[9],text9:elem[10],text10:elem[11],text11:elem[12],text12:elem[13],text13:elem[14]}})}).catch(function(err){throw err}),dataService.getCountryRegulationData($scope.pCountry2).then(function(data){data.data.resultset.map(function(elem){$scope.country2Data={country_code:elem[0],country_name:elem[1],text1:elem[2],text2:elem[3],text3:elem[4],text4:elem[5],text5:elem[6],text6:elem[7],text7:elem[8],text8:elem[9],text9:elem[10],text10:elem[11],text11:elem[12],text12:elem[13],text13:elem[14]}})}).catch(function(err){throw err}),$scope.countryChange=function(){void 0!==$state.current.name&&$state.go($state.current.name,{pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2,pIndicator:$scope.pIndicator})},$(window).on("resize",function(e){resolution=$(window).width()}),resolution=$(window).width(),$scope.openIndicatorsList=function(e){if(resolution<990){if("LI"==e.target.parentElement.nodeName)var parentTag=e.target.parentElement.parentElement.className;else var parentTag=e.target.parentElement.className;parentTag.indexOf("open-list")<0?angular.element(".submenu--items--wrapper").addClass("open-list"):angular.element(".submenu--items--wrapper").removeClass("open-list")}},$("body").on("click touchstart",function(e){var container=angular.element(".submenu--items--wrapper");container.is(e.target)||0!==container.has(e.target).length||angular.element(".submenu--items--wrapper").removeClass("open-list")}),$(".coming-soon").length>0){var h=Number($("header").height()+244+130),w=$(window).height(),f=$("footer").height();$(".coming-soon").css("height",w-h-f)}else $(".coming-soon").remove();$(window).on("resize",function(e){if($(".coming-soon").length>0){var h=Number($("header").height()+244+130),w=$(window).height(),f=$("footer").height();$(".coming-soon").css("height",w-h-f)}else $(".coming-soon").remove()}),$scope.changeIndicator=function(e,indicator){void 0!==$state.current.name&&$state.go($state.current.name,{pCountry1:$scope.pCountry1,pCountry2:$scope.pCountry2,pIndicator:indicator})}}return controller.$inject=["$scope","$stateParams","$state","configService","$log","$document","dataService","$window","$sce","$compile","$timeout"],controller});